{
  "project": "OmniSiteTracker",
  "branchName": "ralph/settings-page",
  "description": "Settings Page - Add a dedicated Settings tab where users can customize rotation rest duration, enable/disable body sites, add custom sites with icons, configure notifications, and control data display preferences",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create UserSettings SwiftData Model",
      "description": "As a developer, I need a data model to persist user settings so preferences are saved between app sessions.",
      "acceptanceCriteria": [
        "Create UserSettings.swift in Models folder",
        "Add @Model class UserSettings with fields: minimumRestDays (Int, default 3), showDisabledSitesInHistory (Bool, default true), createdAt (Date), updatedAt (Date)",
        "Add static method getOrCreate(context:) that returns existing settings or creates new singleton",
        "Add UserSettings.self to modelContainer in OmniSiteTrackerApp.swift",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Create CustomSite SwiftData Model",
      "description": "As a developer, I need a data model to store user-defined custom site locations.",
      "acceptanceCriteria": [
        "Create CustomSite.swift in Models folder",
        "Add @Model class CustomSite with fields: id (UUID), name (String), iconName (String, default 'star.fill'), isEnabled (Bool, default true), createdAt (Date)",
        "Add CustomSite.self to modelContainer in OmniSiteTrackerApp.swift",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create DisabledDefaultSite SwiftData Model",
      "description": "As a developer, I need to track which default body locations the user has disabled.",
      "acceptanceCriteria": [
        "Create DisabledDefaultSite.swift in Models folder",
        "Add @Model class DisabledDefaultSite with fields: id (UUID), locationRawValue (String storing BodyLocation.rawValue), disabledAt (Date)",
        "Add computed property 'location' that converts rawValue to BodyLocation",
        "Add DisabledDefaultSite.self to modelContainer in OmniSiteTrackerApp.swift",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create NotificationSettings SwiftData Model",
      "description": "As a developer, I need a data model to persist notification preferences.",
      "acceptanceCriteria": [
        "Create NotificationSettings.swift in Models folder",
        "Add @Model class NotificationSettings with fields: notificationsEnabled (Bool, default false), reminderHour (Int, default 9), reminderMinute (Int, default 0), daysBeforeReminder (Int, default 0)",
        "Add static method getOrCreate(context:) for singleton pattern",
        "Add NotificationSettings.self to modelContainer in OmniSiteTrackerApp.swift",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create SettingsViewModel",
      "description": "As a developer, I need a view model to manage settings state and persistence.",
      "acceptanceCriteria": [
        "Create SettingsViewModel.swift in ViewModels folder",
        "Add @Observable class SettingsViewModel",
        "Add configure(with modelContext:) method",
        "Add getRestDuration() -> Int and updateRestDuration(days: Int) methods",
        "Add getDisabledDefaultSites() -> [BodyLocation] method",
        "Add toggleDefaultSite(location: BodyLocation) method",
        "Add getCustomSites() -> [CustomSite] method",
        "Add addCustomSite(name: String, iconName: String) method",
        "Add deleteCustomSite(id: UUID) method",
        "Add toggleCustomSite(id: UUID) method",
        "Add getShowDisabledSitesInHistory() -> Bool and updateShowDisabledSitesInHistory(show: Bool) methods",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create SettingsView Basic Structure",
      "description": "As a user, I want a Settings tab so I can access app preferences.",
      "acceptanceCriteria": [
        "Create SettingsView.swift in Views folder",
        "Use NavigationStack with ScrollView and VStack layout",
        "Add 'Settings' as navigation title with .large display mode",
        "Use WarmGradientBackground() for background",
        "Add Settings tab to ContentView as 4th tab with SF Symbol 'gearshape.fill'",
        "Tab styling matches existing Home/History/Patterns tabs",
        "Add file to project.pbxproj",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement Rest Duration Setting UI",
      "description": "As a user, I want to customize how many days a site should rest before being recommended again.",
      "acceptanceCriteria": [
        "Add 'Rotation Settings' section in SettingsView using SectionHeader",
        "Display Stepper with label 'Minimum Rest Days' bound to SettingsViewModel",
        "Stepper allows values from 1 to 30 days",
        "Show current value prominently next to stepper",
        "Add helper text: 'Days before a site can be used again'",
        "Changes save automatically via SettingsViewModel",
        "Wrap section in .neumorphicCard() style",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement Default Sites Toggle UI",
      "description": "As a user, I want to enable or disable default body locations so I only see sites I actually use.",
      "acceptanceCriteria": [
        "Add 'Body Sites' section in SettingsView using SectionHeader",
        "List all 8 BodyLocation.allCases with Toggle for each",
        "Display location icon (location.iconName) and displayName",
        "Toggle ON means site is enabled, OFF means disabled",
        "Show alert if user tries to disable all sites (at least one must remain)",
        "Changes save automatically via SettingsViewModel.toggleDefaultSite()",
        "Wrap section in .neumorphicCard() style",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Implement Custom Sites List UI",
      "description": "As a user, I want to see and manage my custom site locations.",
      "acceptanceCriteria": [
        "Add 'Custom Sites' subsection below Body Sites",
        "List existing custom sites with: icon (SF Symbol from iconName), name, Toggle, delete button",
        "Toggle enables/disables the custom site",
        "Delete button (trash icon) removes the custom site with confirmation",
        "Show 'No custom sites yet' empty state if list is empty",
        "Add '+ Add Custom Site' button at bottom of list",
        "Button styled with appAccent color",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement Add Custom Site Sheet",
      "description": "As a user, I want to add new custom site locations with a name and icon.",
      "acceptanceCriteria": [
        "Tapping '+ Add Custom Site' presents a sheet",
        "Sheet contains TextField for site name",
        "Sheet contains icon picker grid with 15 curated SF Symbols: star.fill, circle.fill, square.fill, triangle.fill, heart.fill, bolt.fill, leaf.fill, drop.fill, flame.fill, moon.fill, sun.max.fill, cross.fill, pills.fill, bandage.fill, syringe.fill",
        "Selected icon shows visual highlight",
        "Add button disabled until name is non-empty",
        "Show error if name already exists",
        "Tapping Add calls SettingsViewModel.addCustomSite() and dismisses sheet",
        "Cancel button dismisses without saving",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Implement Data Display Preference UI",
      "description": "As a user, I want to choose whether disabled sites appear in my history and patterns views.",
      "acceptanceCriteria": [
        "Add 'Data Display' section in SettingsView using SectionHeader",
        "Add Toggle for 'Show Disabled Sites in History'",
        "Default value is ON (true)",
        "Add helper text: 'When off, disabled sites are hidden from History and Patterns'",
        "Changes save automatically via SettingsViewModel",
        "Wrap section in .neumorphicCard() style",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Implement Notification Settings UI",
      "description": "As a user, I want to configure reminder notifications for site rotation.",
      "acceptanceCriteria": [
        "Add 'Notifications' section in SettingsView using SectionHeader",
        "Add master Toggle for 'Enable Reminders'",
        "When enabled, show DatePicker for reminder time (hour and minute only)",
        "Default time is 9:00 AM",
        "Add Stepper for 'Days before site is ready' (0-7 range, default 0)",
        "When disabled, hide time picker and days stepper",
        "Request notification permission when user enables reminders",
        "If permission denied, show button to open Settings app",
        "Wrap section in .neumorphicCard() style",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Implement About Section UI",
      "description": "As a user, I want to see app version and attribution information.",
      "acceptanceCriteria": [
        "Add 'About' section at bottom of SettingsView using SectionHeader",
        "Display app version from Bundle.main.infoDictionary",
        "Display 'Made with love for Theo' attribution text",
        "Add 'Privacy Policy' row that opens URL in Safari (placeholder URL for now)",
        "Add 'Send Feedback' row that opens email composer or mailto: link",
        "Wrap section in .neumorphicCard() style",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Implement Reset to Defaults",
      "description": "As a user, I want to reset my settings to defaults if needed.",
      "acceptanceCriteria": [
        "Add 'Reset to Defaults' button at bottom of SettingsView",
        "Button styled with secondary/destructive appearance",
        "Tapping shows confirmation alert: 'Reset all settings to defaults?'",
        "Confirming resets: rest days to 3, all default sites enabled, custom sites deleted, notifications disabled, show disabled sites ON",
        "Show success toast or feedback after reset",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Integrate Rest Duration with PlacementViewModel",
      "description": "As a user, I want the app's recommendations to respect my custom rest duration setting.",
      "acceptanceCriteria": [
        "Update PlacementViewModel to read minimumRestDays from UserSettings instead of hardcoded value",
        "Add method or property to fetch current rest duration from UserSettings",
        "statusColor(for location:) uses dynamic rest duration",
        "recommendedSite calculation uses dynamic rest duration",
        "calculateRotationScore uses dynamic rest duration for rest compliance",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Integrate Site Toggles with BodyDiagramView",
      "description": "As a user, I want the body diagram to only show sites I have enabled.",
      "acceptanceCriteria": [
        "Update BodyDiagramView to accept list of enabled locations",
        "Filter frontZones and backZones to only include enabled locations",
        "Disabled default sites do not appear on body diagram",
        "Disabled sites do not appear in recommendations",
        "Update HomeView to pass enabled locations to BodyDiagramView",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Integrate Site Toggles with HeatmapBodyDiagramView",
      "description": "As a user, I want the heatmap to only show sites I have enabled.",
      "acceptanceCriteria": [
        "Update HeatmapBodyDiagramView to accept list of enabled locations",
        "Filter frontZones and backZones to only include enabled locations",
        "Disabled default sites do not appear on heatmap diagram",
        "Update PatternsView to pass enabled locations to HeatmapBodyDiagramView",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Integrate Custom Sites with Home Screen",
      "description": "As a user, I want to log placements for my custom sites from the Home screen.",
      "acceptanceCriteria": [
        "Add 'Custom Sites' section on HomeView below body diagram (only if custom sites exist)",
        "Display list of enabled custom sites as tappable buttons",
        "Each button shows custom site icon and name",
        "Tapping a custom site triggers same placement confirmation flow as default sites",
        "Use similar styling to zone buttons but in a horizontal scroll or grid layout",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Update PlacementLog to Support Custom Sites",
      "description": "As a developer, I need PlacementLog to store custom site placements.",
      "acceptanceCriteria": [
        "Add optional customSiteId (UUID?) field to PlacementLog model",
        "Add optional customSiteName (String?) field to PlacementLog for display purposes",
        "Existing placements continue to use location (BodyLocation) field",
        "Custom site placements have location = nil and customSiteId populated",
        "Add computed property to determine if placement is custom or default",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Integrate Custom Sites with History View",
      "description": "As a user, I want to see custom site placements in my history.",
      "acceptanceCriteria": [
        "Update HistoryView to display custom site placements",
        "Custom site entries show custom site icon and name instead of BodyLocation",
        "Custom site entries have same styling and interaction as default site entries",
        "Filter and sort work correctly with mixed default and custom site entries",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Integrate History Display Preference",
      "description": "As a developer, I need to filter history and patterns based on the user's display preference.",
      "acceptanceCriteria": [
        "Update HistoryView to check showDisabledSitesInHistory setting",
        "When OFF, filter out placements for currently disabled default sites",
        "When OFF, filter out placements for deleted custom sites",
        "When ON, show all historical placements regardless of current site status",
        "Update PatternsView heatmap data to respect the setting",
        "Update zone statistics to respect the setting",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Implement Notification Scheduling",
      "description": "As a user, I want to receive notifications when sites are ready to use again.",
      "acceptanceCriteria": [
        "Create NotificationManager class to handle UNUserNotificationCenter",
        "Add method to request notification permissions",
        "Add method to schedule notification for specific site becoming ready",
        "Notification fires at user's configured time on the day site becomes ready (minus daysBeforeReminder)",
        "Notification title: 'Site Ready' and body shows which site is available",
        "Add method to cancel all scheduled notifications (used when reminders disabled)",
        "Update notifications when new placement is logged",
        "Use default iOS notification sound",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    }
  ]
}
